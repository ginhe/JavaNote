## 在线用户数

每当有新的用户访问店铺时，服务端生成唯一的sessionId，将店铺id和sessionId放在redis的set里。因此统计在线用户数就是查看set的长度。

**如何知道用户离开店铺？**（关闭浏览器或者用户关闭店铺的所有页面并且在一定时间内未调用心跳通知接口）

可以设置key的失效事件，使用代码监听redis这个key失效的事件。
如果是新用户（第一次访问）调用，我会将其sessionid作为key保存到redis里面，并且设置它的失效事件（暂且设为1min），如果不是新用户，直接更新这个key即可；更新接口做一样操作，直接更新这个key，这样，只要有心跳通知，或者收集接口，这个key会一直存在，也就认为这个用户在线；如果超过一分钟未更新，那么key的失效事件会被触发，同时将sessionid从xxx_shopId的set集合中移除即可。







## 参考资料

[统计当前在线用户数](https://my.oschina.net/beanGo/blog/1507424)